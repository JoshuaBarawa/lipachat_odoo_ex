<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Template Form View -->
        <record id="view_lipachat_template_form" model="ir.ui.view">
            <field name="name">lipachat.template.form</field>
            <field name="model">lipachat.template</field>
            <field name="arch" type="xml">
                <form string="WhatsApp Template">
                    <header>
                        <button name="create_template" string="Create Template" type="object" 
                                class="btn-primary" 
                                invisible="header_type != 'TEXT' and header_type and not header_media_id"/>
                        <field name="status" widget="statusbar" statusbar_visible="draft,submitted,approved,rejected"/>
                    </header>
                    <sheet>
                        <!-- First row with Template Name, Category, and Language -->
                        <group class="flex-container">
                            <field name="name" class="flex-item"/>
                            <field name="category" class="flex-item"/>
                            <field name="language" class="flex-item"/>
                        </group>

                        <!-- Phone number field -->
                        <group string="WABA Phone Number" class="mt16">
                            <field name="phone_number" widget="phone" placeholder="Example: 254110090747"/>
                        </group>
                        
                        <!-- Header Section -->
                        <group string="Header (Optional)" class="mt16">
                            <field name="header_type"/>
                            <field name="header_text" invisible="header_type != 'TEXT'" 
                                   placeholder="Enter header text (use {{1}}, {{2}} for variables)"/>
                            <field name="header_example" invisible="header_type != 'TEXT'" 
                                   placeholder="Example value for {{1}}"/>
                            
                            <!-- Media Upload Section -->
                            <div invisible="header_type == 'TEXT' or not header_type">
                                <group>
                                    <!-- File upload field - always visible when media type is selected -->
                                    <field name="header_media" filename="header_media_filename"
                                           invisible="header_type == 'TEXT' or not header_type"/>
                                    <field name="header_media_filename" invisible="1"/>
                                    
                                    <!-- Hidden fields for upload status -->
                                    <field name="is_uploading_media" invisible="1"/>
                                    <field name="upload_status" invisible="1"/>
                                    <field name="upload_error_message" invisible="1"/>
                                    
                                    <!-- Upload Status Indicators -->
                                    <div invisible="upload_status != 'uploading'" class="alert alert-info">
                                        <i class="fa fa-spinner fa-spin"/> Uploading media, please wait...
                                    </div>
                                    
                                    <div invisible="upload_status != 'success'" class="alert alert-success">
                                        <i class="fa fa-check-circle"/> Media uploaded successfully! 
                                        <strong>Media ID:</strong> <field name="header_media_id" readonly="1" class="oe_inline"/>
                                        <br/>
                                        <button name="clear_media" string="Change Media" type="object" 
                                                class="btn btn-sm btn-warning mt8" icon="fa-refresh"/>
                                    </div>
                                    
                                    <div invisible="upload_status != 'error'" class="alert alert-danger">
                                        <i class="fa fa-exclamation-triangle"/> Upload failed: 
                                        <span invisible="not upload_error_message">
                                            <field name="upload_error_message" readonly="1" class="oe_inline"/>
                                        </span>
                                        <br/>
                                        <button name="retry_upload" string="Retry Upload" type="object" 
                                                class="btn btn-sm btn-primary mt8" icon="fa-refresh"/>
                                        <button name="clear_media" string="Change Media" type="object" 
                                                class="btn btn-sm btn-warning mt8" icon="fa-times"/>
                                    </div>
                                    
                                    <!-- Info message for new uploads -->
                                    <div invisible="header_media or upload_status != 'none'" class="alert alert-info">
                                        <i class="fa fa-info-circle"/> Select a media file and it will be uploaded automatically.
                                        <br/>
                                        <small>
                                            <strong>Supported formats:</strong>
                                            <ul>
                                                <li invisible="header_type != 'IMAGE'">Images: JPG, PNG, GIF, WebP (max 5MB)</li>
                                                <li invisible="header_type != 'VIDEO'">Videos: MP4, 3GPP (max 16MB)</li>
                                                <li invisible="header_type != 'DOCUMENT'">Documents: PDF, DOC, DOCX, TXT, etc. (max 100MB)</li>
                                            </ul>
                                        </small>
                                    </div>
                                </group>
                            </div>
                        </group>
                        
                        <!-- Body Section -->
                        <group string="Body" class="mt16">
                            <field name="body_text" nolabel="1" 
                                   placeholder="Enter your message (use {{1}}, {{2}} for variables)"
                                   invisible="category == 'AUTHENTICATION'"/>
                            <field name="body_examples" 
                                   placeholder='["Example 1", "Example 2"] - JSON array for variables {{1}}, {{2}}'
                                   invisible="category == 'AUTHENTICATION'"/>
                            <field name="add_security_recommendation" 
                                   invisible="category != 'AUTHENTICATION'"/>
                        </group>
                        
                        <!-- Footer Section -->
                        <group string="Footer (Optional)" class="mt16">
                            <field name="footer_text" placeholder="Enter footer text..."
                                   invisible="category == 'AUTHENTICATION'"/>
                            <field name="code_expiration_minutes" 
                                   invisible="category != 'AUTHENTICATION'"/>
                        </group>
                        
                        <!-- Buttons Section -->
                        <group string="Buttons (Optional, max 3)" class="mt16">
                            <h2 class="button-count-titles">Button 1</h2>
                            <group>
                                <field name="button_1_type"/>
                                <field name="button_1_text" placeholder="Button text"
                                       invisible="not button_1_type"/> 
                                <field name="button_1_url" 
                                       invisible="button_1_type != 'URL'" 
                                       placeholder="https://example.com"/>
                                <field name="button_1_url_example" 
                                       invisible="button_1_type != 'URL'" 
                                       placeholder="Example URL for variables"/>
                                <field name="button_1_phone_number" 
                                       invisible="button_1_type != 'PHONE_NUMBER'" 
                                       widget="phone" placeholder="+254712345678"/>
                                <field name="button_1_phone_example" 
                                       invisible="button_1_type != 'PHONE_NUMBER'" 
                                       placeholder="Example phone for variables"/>
                                <field name="button_1_otp_type" 
                                       invisible="button_1_type != 'OTP'"/>
                            </group>
                            
                            <h2 class="button-count-titles">Button 2</h2>
                            <group>
                                <field name="button_2_type"/>
                                <field name="button_2_text" placeholder="Button text"
                                       invisible="not button_2_type"/>
                                <field name="button_2_url" 
                                       invisible="button_2_type != 'URL'" 
                                       placeholder="https://example.com"/>
                                <field name="button_2_url_example" 
                                       invisible="button_2_type != 'URL'" 
                                       placeholder="Example URL for variables"/>
                                <field name="button_2_phone_number" 
                                       invisible="button_2_type != 'PHONE_NUMBER'" 
                                       widget="phone" placeholder="+254712345678"/>
                                <field name="button_2_phone_example" 
                                       invisible="button_2_type != 'PHONE_NUMBER'" 
                                       placeholder="Example phone for variables"/>
                                <field name="button_2_otp_type" 
                                       invisible="button_2_type != 'OTP'"/>
                            </group>
                            
                            <h2 class="button-count-titles">Button 3</h2>
                            <group>
                                <field name="button_3_type"/>
                                <field name="button_3_text" placeholder="Button text"
                                       invisible="not button_3_type"/>
                                <field name="button_3_url" 
                                       invisible="button_3_type != 'URL'" 
                                       placeholder="https://example.com"/>
                                <field name="button_3_url_example" 
                                       invisible="button_3_type != 'URL'" 
                                       placeholder="Example URL for variables"/>
                                <field name="button_3_phone_number" 
                                       invisible="button_3_type != 'PHONE_NUMBER'" 
                                       widget="phone" placeholder="+254712345678"/>
                                <field name="button_3_phone_example" 
                                       invisible="button_3_type != 'PHONE_NUMBER'" 
                                       placeholder="Example phone for variables"/>
                                <field name="button_3_otp_type" 
                                       invisible="button_3_type != 'OTP'"/>
                            </group>
                        </group>

                        <!-- Component Data Preview -->
                        <group string="Generated Component Data (Preview)" class="mt16">
                            <field name="component_data" widget="ace" options="{'mode': 'json'}" readonly="1"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- Template Tree View -->
        <record id="view_lipachat_template_tree" model="ir.ui.view">
            <field name="name">lipachat.template.tree</field>
            <field name="model">lipachat.template</field>
            <field name="arch" type="xml">
                <tree string="WhatsApp Templates" decoration-success="status=='approved'" decoration-warning="status=='submitted'">
                    <field name="name"/>
                    <field name="category"/>
                    <field name="language"/>
                    <field name="phone_number"/>
                    <field name="status"/>
                </tree>
            </field>
        </record>

        <!-- Template Action -->
        <record id="action_lipachat_template" model="ir.actions.act_window">
            <field name="name">WhatsApp Templates</field>
            <field name="res_model">lipachat.template</field>
            <field name="view_mode">tree,form</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Create your first WhatsApp template
                </p>
                <p>
                    Templates allow you to send pre-approved messages to customers.
                </p>
            </field>
        </record>
    </data>
</odoo>