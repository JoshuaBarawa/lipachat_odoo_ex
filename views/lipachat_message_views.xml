<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Custom CSS for LipaChat Message Styling -->
        <template id="lipachat_message_assets" name="LipaChat Message Assets">
            <style type="text/css">
                /* Base styling similar to config form */
                .lipachat-message-form {
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
                    min-height: 100vh;
                    padding: 20px;
                }
                .lipachat-message-form .o_form_sheet_bg {
                    background: white !important;
                    border-radius: 15px !important;
                    box-shadow: 0 20px 40px rgba(0,0,0,0.1) !important;
                    padding: 30px !important;
                    margin: 20px auto !important;
                    max-width: 1200px !important;
                }
                .lipachat-message-form .oe_title h1 {
                    color: #2c3e50 !important;
                    font-weight: 700 !important;
                    margin-bottom: 30px !important;
                    text-align: center !important;
                    position: relative !important;
                }
                .lipachat-message-form .oe_title h1:after {
                    content: '';
                    position: absolute;
                    bottom: -10px;
                    left: 50%;
                    transform: translateX(-50%);
                    width: 80px;
                    height: 3px;
                    background: linear-gradient(90deg, #667eea, #764ba2);
                    border-radius: 2px;
                }
                .lipachat-message-form .o_form_sheet > header {
                    background: linear-gradient(135deg, #25D366 0%, #128C7E 100%) !important;
                    padding: 15px 25px !important;
                    border-radius: 10px !important;
                    margin-bottom: 25px !important;
                    text-align: center !important;
                    border: none !important;
                }
                .lipachat-message-form .btn-primary {
                    background: linear-gradient(135deg, #25D366 0%, #128C7E 100%) !important;
                    border: none !important;
                    padding: 12px 30px !important;
                    border-radius: 25px !important;
                    font-weight: 600 !important;
                    font-size: 14px !important;
                    text-transform: uppercase !important;
                    letter-spacing: 1px !important;
                    transition: all 0.3s ease !important;
                    box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3) !important;
                }
                .lipachat-message-form .btn-primary:hover {
                    transform: translateY(-2px) !important;
                    box-shadow: 0 6px 20px rgba(37, 211, 102, 0.4) !important;
                }
                .lipachat-message-form .o_group {
                    background: #f8f9fa !important;
                    padding: 25px !important;
                    border-radius: 12px !important;
                    margin-bottom: 20px !important;
                    border: 1px solid #e9ecef !important;
                }
                .lipachat-message-form .o_form_label {
                    color: #495057 !important;
                    font-weight: 600 !important;
                    font-size: 13px !important;
                    text-transform: uppercase !important;
                    letter-spacing: 0.5px !important;
                    margin-bottom: 8px !important;
                }
                .lipachat-message-form .o_field_widget input,
                .lipachat-message-form .o_field_widget select,
                .lipachat-message-form .o_field_widget textarea {
                    border-radius: 8px !important;
                    border: 2px solid #e9ecef !important;
                    padding: 12px 15px !important;
                    font-size: 14px !important;
                    transition: all 0.3s ease !important;
                    background: white !important;
                    width: 100% !important;
                    min-width: 100% !important;
                    box-sizing: border-box !important;
                }
                .lipachat-message-form .o_field_widget input:focus,
                .lipachat-message-form .o_field_widget select:focus,
                .lipachat-message-form .o_field_widget textarea:focus {
                    border-color: #667eea !important;
                    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1) !important;
                    outline: none !important;
                }
                .lipachat-message-form .o_field_widget.o_readonly input,
                .lipachat-message-form .o_field_widget.o_readonly textarea {
                    background: #f1f3f4 !important;
                    color: #6c757d !important;
                    cursor: not-allowed !important;
                    border-color: #dee2e6 !important;
                }
                
                /* Enhanced Message Content Styling */
                .lipachat-message-form .o_notebook .tab-content .o_group {
                    width: 100% !important;
                    max-width: none !important;
                }
                
                /* Message text field - Force full width and override all constraints */
                .lipachat-message-form .o_field_widget[name="message_text"] {
                    width: 100% !important;
                    max-width: 100% !important;
                    display: block !important;
                    flex: none !important;
                }
                
                .lipachat-message-form .o_field_widget[name="message_text"] textarea {
                    width: 100% !important;
                    min-width: 100% !important;
                    max-width: 100% !important;
                    min-height: 120px !important;
                    resize: vertical !important;
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
                    line-height: 1.5 !important;
                    display: block !important;
                }
                
                /* Override any Odoo column constraints for message text */
                .lipachat-message-form .tab-pane > .o_group:first-child {
                    width: 100% !important;
                    max-width: 100% !important;
                    flex: none !important;
                    display: block !important;
                }
                
                .lipachat-message-form .tab-pane > .o_group:first-child .o_field_widget {
                    width: 100% !important;
                    max-width: 100% !important;
                    display: block !important;
                }
                
                /* Media and template fields full width */
                .lipachat-message-form .o_field_widget[name="media_url"] input,
                .lipachat-message-form .o_field_widget[name="caption"] textarea,
                .lipachat-message-form .o_field_widget[name="header_text"] input,
                .lipachat-message-form .o_field_widget[name="body_text"] textarea,
                .lipachat-message-form .o_field_widget[name="button_text"] input,
                .lipachat-message-form .o_field_widget[name="template_name"] input {
                    width: 100% !important;
                    min-width: 100% !important;
                }
                
                /* JSON fields styling */
                .lipachat-message-form .o_field_widget[name="buttons_data"],
                .lipachat-message-form .o_field_widget[name="template_data"],
                .lipachat-message-form .o_field_widget[name="response_data"] {
                    width: 100% !important;
                    max-width: 100% !important;
                }
                
                .lipachat-message-form .o_field_widget[name="buttons_data"] .ace_editor,
                .lipachat-message-form .o_field_widget[name="template_data"] .ace_editor,
                .lipachat-message-form .o_field_widget[name="response_data"] .ace_editor {
                    width: 100% !important;
                    min-height: 150px !important;
                    border-radius: 8px !important;
                    border: 2px solid #e9ecef !important;
                    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace !important;
                    font-size: 13px !important;
                }
                
                /* Tab content enhancements */
                .lipachat-message-form .nav-tabs {
                    border: none !important;
                    margin-top: 30px !important;
                    margin-bottom: 0 !important;
                }
                .lipachat-message-form .nav-tabs .nav-link {
                    background: transparent !important;
                    border: 2px solid transparent !important;
                    color: #6c757d !important;
                    font-weight: 600 !important;
                    padding: 12px 25px !important;
                    border-radius: 25px !important;
                    margin-right: 10px !important;
                    transition: all 0.3s ease !important;
                }
                .lipachat-message-form .nav-tabs .nav-link.active {
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
                    color: white !important;
                    border-color: transparent !important;
                }
                .lipachat-message-form .tab-content {
                    background: white !important;
                    padding: 25px !important;
                    border-radius: 12px !important;
                    box-shadow: 0 4px 15px rgba(0,0,0,0.05) !important;
                    margin-top: 15px !important;
                }
                
                /* Group sections within tabs */
                .lipachat-message-form .tab-pane .o_group {
                    margin-bottom: 25px !important;
                    border-left: 4px solid #667eea !important;
                    position: relative !important;
                }
                
                .lipachat-message-form .tab-pane .o_group[string]:before {
                    content: attr(string);
                    position: absolute;
                    top: -10px;
                    left: 15px;
                    background: white;
                    padding: 0 10px;
                    color: #667eea;
                    font-weight: 700;
                    font-size: 12px;
                    text-transform: uppercase;
                    letter-spacing: 1px;
                }
                
                /* Status bar styling */
                .lipachat-message-form .o_statusbar_status {
                    border-radius: 20px !important;
                    overflow: hidden !important;
                }
                
                .lipachat-message-form .o_statusbar_status .o_arrow_button {
                    border-radius: 0 !important;
                    padding: 8px 16px !important;
                    font-weight: 600 !important;
                    text-transform: uppercase !important;
                    font-size: 11px !important;
                    letter-spacing: 0.5px !important;
                }
                
                .lipachat-message-form .o_statusbar_status .o_arrow_button.btn-primary {
                    background: linear-gradient(135deg, #25D366 0%, #128C7E 100%) !important;
                    border: none !important;
                }
                
                /* Make message content groups full width */
                .lipachat-message-form .o_notebook > .tab-content .group {
                    width: 100% !important;
                    flex: none !important;
                    margin-bottom: 25px !important;
                    box-sizing: border-box !important;
                }
                
                /* Form row improvements */
                .lipachat-message-form .o_row {
                    display: flex !important;
                    width: 100% !important;
                    align-items: flex-end !important;
                    gap: 15px !important;
                }
                
                .lipachat-message-form .o_row > .o_field_widget {
                    flex: 1 !important;
                    min-width: 0 !important;
                }
                
                /* Responsive Design */
                @media (max-width: 768px) {
                    .lipachat-message-form .o_form_sheet_bg {
                        margin: 10px !important;
                        padding: 20px !important;
                    }
                    .lipachat-message-form .o_group {
                        padding: 15px !important;
                    }
                    .lipachat-message-form .nav-tabs .nav-link {
                        padding: 8px 15px !important;
                        font-size: 12px !important;
                        margin-bottom: 5px !important;
                    }
                }
            </style>
        </template>

        <!-- Message Form View -->
        <record id="view_lipachat_message_form" model="ir.ui.view">
            <field name="name">lipachat.message.form</field>
            <field name="model">lipachat.message</field>
            <field name="arch" type="xml">
                <form string="WhatsApp Message" class="lipachat-message-form">
                    <header>
                        <button name="send_message" string="Send Message" type="object" class="btn-primary"/>
                        <field name="state" widget="statusbar"/>
                    </header>
                    <sheet>
                        <group>
                            <group>
                                <field name="partner_id"/>
                                <field name="phone_number"/>
                                <!-- New config selection -->
                                <field name="config_id" domain="[('active', '=', True)]" />
                                <!-- from_number is now readonly and related to config -->
                                <field name="from_number" readonly="1"/>
                                <field name="message_type"/>
                            </group>
                            <group>
                                <field name="message_id"/>
                                <field name="create_date"/>
                            </group>
                        </group>

                        <notebook>
                            <page string="Message Content">
                                <!-- Main message text - full width, no group wrapper -->
                                <div class="o_group" style="width: 100%; max-width: 100%;">
                                    <field name="message_text" nolabel="1" placeholder="Enter your message text" style="width: 100%; max-width: 100%;"/>
                                </div>
                                <group string="Media Message">
                                    <field name="media_type"/>
                                    <field name="media_url"/>
                                    <field name="caption"/>
                                </group>
                                <group string="Interactive Content">
                                    <field name="header_text"/>
                                    <field name="body_text"/>
                                    <field name="button_text"/>
                                    <field name="buttons_data" widget="ace" options="{'mode': 'json'}" nolabel="1"/>
                                </group>
                                <group string="Template Message">
                                    <field name="template_name"/>
                                    <field name="template_language"/>
                                    <field name="template_data" widget="ace" options="{'mode': 'json'}"/>
                                </group>
                            </page>

                            <page string="Response Details">
                                <group>
                                    <field name="error_message"/>
                                    <field name="response_data" widget="ace" options="{'mode': 'json'}" readonly="1"/>
                                </group>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- Message Tree View (unchanged) -->
        <record id="view_lipachat_message_tree" model="ir.ui.view">
            <field name="name">lipachat.message.tree</field>
            <field name="model">lipachat.message</field>
            <field name="arch" type="xml">
                <tree string="WhatsApp Messages" decoration-success="state=='sent'" decoration-danger="state=='failed'">
                    <field name="create_date"/>
                    <field name="partner_id"/>
                    <field name="phone_number"/>
                    <field name="message_type"/>
                    <field name="message_text" string="Content"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <!-- Message Action (unchanged) -->
        <record id="action_lipachat_message" model="ir.actions.act_window">
            <field name="name">WhatsApp Messages</field>
            <field name="res_model">lipachat.message</field>
            <field name="view_mode">tree,form</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No WhatsApp messages yet
                </p>
                <p>
                    Send your first WhatsApp message from a contact or create one here.
                </p>
            </field>
        </record>
    </data>
</odoo>