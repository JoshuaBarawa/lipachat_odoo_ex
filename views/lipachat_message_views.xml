<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Custom CSS for LipaChat Message Styling -->
        <template id="lipachat_message_assets" name="LipaChat Message Assets">
            <style type="text/css">
                /* Previous CSS styles remain unchanged */
                /* Add this new style for the many2many tags */
                .lipachat-message-form .o_field_widget[name="partner_ids"] .o_field_many2many_tags {
                    width: 100%;
                    min-height: 34px;
                    border-radius: 8px !important;
                    border: 2px solid #e9ecef !important;
                    padding: 5px !important;
                    background: white !important;
                }
                .lipachat-message-form .o_field_widget[name="partner_ids"] .o_field_many2many_tags .badge {
                    background: linear-gradient(135deg, #25D366 0%, #128C7E 100%) !important;
                    color: white !important;
                    border: none !important;
                    margin: 2px !important;
                    padding: 5px 10px !important;
                    border-radius: 12px !important;
                }
                .lipachat-message-form .o_field_widget[name="partner_ids"] .o_input_dropdown {
                    width: 100% !important;
                }
                .lipachat-message-form .recipient-selection {
                    margin-bottom: 15px;
                    border-bottom: 1px solid #e9ecef;
                    padding-bottom: 15px;
                }
            </style>
        </template>

        <!-- Message Form View -->
        <record id="view_lipachat_message_form" model="ir.ui.view">
            <field name="name">lipachat.message.form</field>
            <field name="model">lipachat.message</field>
            <field name="arch" type="xml">
                <form string="WhatsApp Message" class="lipachat-message-form">
                    <header>
                        <button name="send_message" string="Send Message" type="object" class="btn-primary"/>
                        <field name="state" widget="statusbar"/>
                    </header>
                    <sheet>
                        <div class="recipient-selection">
                            <h2>Recipients</h2>
                            <group>
                                <group>
                                    <field name="partner_ids" widget="many2many_tags" 
                                        placeholder="Select multiple contacts..."
                                        options="{'no_create': True}"/>
                                </group>
                                <group>
                                    <label for="phone_number" string="Or specify phone number"/>
                                    <div class="o_row">
                                        <field name="partner_id" options="{'no_create': True}" 
                                            invisible="partner_ids" placeholder="Select contact"/>
                                        <field name="phone_number" 
                                            invisible="partner_ids" placeholder="Enter phone number"/>
                                    </div>

                                </group>
                            </group>
                        </div>

                        <group>
                            <group>
                                <!-- New config selection -->
                                <field name="config_id" domain="[('active', '=', True)]" />
                                <!-- from_number is now readonly and related to config -->
                                <field name="from_number" readonly="1"/>
                                <field name="message_type"/>
                            </group>
                            <group>
                                <field name="message_id"/>
                                <field name="create_date"/>
                            </group>
                        </group>

                        <notebook>
                            <page string="Message Content">
                                <!-- Main message text - full width, no group wrapper -->
                                <div class="o_group" style="width: 100%; max-width: 100%;">
                                    <field name="message_text" nolabel="1" placeholder="Enter your message text" style="width: 100%; max-width: 100%;"/>
                                </div>
                                <group string="Media Message">
                                    <field name="media_type"/>
                                    <field name="media_url"/>
                                    <field name="caption"/>
                                </group>
                                <group string="Interactive Content">
                                    <field name="header_text"/>
                                    <field name="body_text"/>
                                    <field name="button_text"/>
                                    <field name="buttons_data" widget="ace" options="{'mode': 'json'}" nolabel="1"/>
                                </group>
                                <group string="Template Message">
                                    <field name="template_name"/>
                                    <field name="template_language"/>
                                    <field name="template_data" widget="ace" options="{'mode': 'json'}"/>
                                </group>
                            </page>

                            <page string="Response Details">
                                <group>
                                    <field name="error_message"/>
                                    <field name="sent_contacts" readonly="1"/>
                                    <field name="failed_contacts" readonly="1"/>
                                    <field name="response_data" widget="ace" options="{'mode': 'json'}" readonly="1"/>
                                </group>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- Message Tree View (updated) -->
        <record id="view_lipachat_message_tree" model="ir.ui.view">
            <field name="name">lipachat.message.tree</field>
            <field name="model">lipachat.message</field>
            <field name="arch" type="xml">
                <tree string="WhatsApp Messages" decoration-success="state=='sent'" decoration-danger="state=='failed'" decoration-warning="state=='partially_sent'">
                    <field name="create_date"/>
                    <field name="partner_id" invisible="1"/>
                    <field name="partner_ids" widget="many2many_tags"/>
                    <field name="phone_number"/>
                    <field name="message_type"/>
                    <field name="message_text" string="Content"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <!-- Message Action (unchanged) -->
        <record id="action_lipachat_message" model="ir.actions.act_window">
            <field name="name">WhatsApp Messages</field>
            <field name="res_model">lipachat.message</field>
            <field name="view_mode">tree,form</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No WhatsApp messages yet
                </p>
                <p>
                    Send your first WhatsApp message from a contact or create one here.
                </p>
            </field>
        </record>
    </data>
</odoo>